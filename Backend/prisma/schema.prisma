generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model user {
  id         String    @id @default(uuid())
  username   String    @unique
  password   String
  name       String?
  image      String?
  bio        String?
  posts      post[]
  followedBy user[]    @relation("UserFollow")
  following  user[]    @relation("UserFollow")
  likedPosts post[]    @relation("user_like_post")
  comments   comment[]
  joinedAt   DateTime  @default(now())
  watchList  movie[]   @relation("user_watch_list")
}

model post {
  id        String    @id @default(uuid())
  content   String?
  image     String?
  author    user      @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId  String
  likedBy   user[]    @relation("user_like_post")
  comments  comment[]
  createdAt DateTime  @default(now())
  movie     movie?    @relation(fields: [movieId], references: [id])
  movieId   String
  rating    Int?

  @@index([authorId, createdAt])
  @@index([movieId, createdAt])
}

model movie {
  id          String  @id @default(uuid())
  sourceId    String  @unique
  title       String
  description String?
  image       String
  genres      genre[] @relation("movie_genre")
  watchListBy user[]  @relation("user_watch_list")
  posts       post[]
}

model comment {
  id        String   @id @default(uuid())
  content   String
  author    user     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId  String
  post      post?    @relation(fields: [postId], references: [id])
  postId    String?
  createdAt DateTime @default(now())

  @@index([postId, createdAt])
  @@index([authorId, createdAt])
}

model genre {
  id     String  @id @default(uuid())
  name   String  @unique
  movies movie[] @relation("movie_genre")
}
